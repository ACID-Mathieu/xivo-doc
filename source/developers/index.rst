**********
Developers
**********

Coding guidelines
=================

Submit a patch
==============

Contribute to the documentation
===============================

XiVO documentation is generated with Sphinx, documentation project source is in git://gitorious.org/xivo-doc/xivo-doc.git

Provided you already have Python installed on your system. You need first to install Sphinx_ : ``easy_install -U Sphinx`` [1]_.

.. _Sphinx: http://sphinx.pocoo.org/ 

Quick Reference

* http://docutils.sourceforge.net/docs/user/rst/cheatsheet.txt
* http://docutils.sourceforge.net/docs/user/rst/quickref.html
* http://openalea.gforge.inria.fr/doc/openalea/doc/_build/html/source/sphinx/rest_syntax.html


.. [1] ``easy_install`` can be found in the debian package python-setuptools : ``sudo apt-get install python-setuptools``

CTI protocol
============

Message flow
------------

Received messages from the CTI clients to the server are received by the CTIServer class. The CTIServer then calls ``interface_cti.CTI`` class ``manage_connection`` method. The ``interface_cti`` uses his ``_cti_command_handler`` member to parse and run the command. The ``CTICommandHandler`` get a list of classes that handle this message from the ``CTICommandFactory``. Then the the ``interface_cti.CTI`` calls ``run_commands`` on the handler, which returns a list of all commands replies.

To implement a new message in the protocol you have to create a new class that inherits the ``CTICommand`` class. Your new class should have a static member caller ``required_fields`` which is a list of required fields for this class. Your class should also have a ``conditions`` static member which is a list of tupples of conditions to detect that an incoming message matches this class. The ``__init__`` of your class is responsible for the initialization of it's fields and should call ``super(<ClassName>, self).__init__(msg)``. Your class should register itself to the ``CTICommandFactory``.

.. code-block:: python

    from xivo_cti.cti.cti_command import CTICommand
    from xivo_cti.cti.cti_command_factory import CTICommandFactory

    class InviteConfroom(CTICommand):
        required_fields = ['class', 'invitee']
        conditions = [('class', 'invite_confroom')]
        def __init__(self):
            super(InviteConfroom, self).__init__(msg)
            self._invitee = msg['invitee']

    CTICommandFactory.register_class(InviteConfroom)

Each CTI commands has a callback list that you can register to from anywhere. Each callback function will be called when this message is received with the command as parameter.

Refer to ``MeetmeList.__init__`` for a callback registration example and to ``MeetmeList.invite`` for the implementation of a callback.

.. code-block:: python

    from xivo_cti.cti.commands.invite_confroom import InviteConfroom

    class MySuperClass(object):
        def __init__(self):
            InviteConfroom.register_callback(self.invite_confroom_handler)

        def invite_confroom_handler(self, invite_confroom_command):
            # Do your stuff here.
            if ok:
                return invite_confroom_command.get_message('Everything is fine')
            else:
                return invite_confroom_command.get_warning('I don't know you, go away', True)


Note: The client's connection is injected in the command instance before calling callbacks functions. The client's connection is an ``interface_cti.CTI`` instance.

Translation
==============

Now we using a centralize tool for the xivo translation. It's transifex and the web acces is : 

* https://www.transifex.net/projects/p/xivo

For each project we have a reference file fetched by transiflex in our git. This file is always by default in english and translate with transifex.

.. image:: images/translation_transifex.png

XiVO Prompts
------------

We have different studio for each languages and prompts. The information for those languages are here :

* French : Super Sonic productions (supersonicprod@wanadoo.fr)
* English : Asterisk voice (allison@theasteriskvoice.com)
* German : ATS studio
* Italian : ATS studio

If you want to add a new prompt you need to edit the xivo-prompts-orig.csv in our git xivo-sounds.

XiVO client
-----------

The file was generated by lupdate and the reference file is xivoclient-en.ts.

Web interface
-------------

Asterisk prompt
---------------
